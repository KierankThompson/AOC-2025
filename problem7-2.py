from collections import defaultdict
with open("problem7.txt", 'r') as f:
    lines = f.read().splitlines()
splitterMap = {}
startingPos = (0,0)
for i, line in enumerate(lines):
    for j, char in enumerate(line):
        if char == '^':
            if j not in splitterMap:
                splitterMap[j] = [(i,j)]
            else:
                splitterMap[j].append((i,j))
        elif char == 'S':
            startingPos = (i,j)

beams = [startingPos]

usedBeams = set()
paths = defaultdict(int)
paths[startingPos] = 1
ans = 0
usedAns = set()
while beams:
    beams.sort()
    i,j = beams.pop(0)
    if j in splitterMap:
        for s_i, s_j in splitterMap[j]:
            if s_i > i:
                if (i, j) not in usedBeams:
                    beams.append((s_i, s_j-1))
                    beams.append((s_i, s_j+1))
                    usedBeams.add((i, j))
                    paths[(s_i, s_j-1)] += paths[(i,j)]
                    paths[(s_i, s_j+1)] += paths[(i,j)]
                break
        if i > splitterMap[j][-1][0]:
            usedAns.add((i,j))
            
    else:
        usedAns.add((i,j))

for i,j in usedAns:
    ans += paths[(i,j)]
    
print(ans)



print(
'''
                                                                   .-*:                             
                                                                  :*@@:                             
                                                                 -*@@%.                             
                     ::                                        .=#@@@*                              
                     =##+:.                   .-:=++=-:.     .--#%%%%=                              
                     .=*%%*-:                .--*#%%%%%%*=:.-**%%####.                              
                      :-=#%%#+-..            --##%+:  ..-=###%%%####*                               
                       -:=######*-..        .=*##........:*#%%%####%=                               
                       .=:#####%%###:     .-=+###***+++*#+##%%######:                               
                        .=+#####%%#%%+---=+**###%######****#%%%##%##:        ..                     
                         :=#####%%#%****+*#*##################%%%%#=*#=:     .*-.                   
                          :+#%%%%%*=*#*+*#*#####################%%#*+=*##+--=*##:                   
                          .:*#%%#-+#*+*#%*########################%%#*+.:+##**+:                    
                      .==-=*. :+:*#**####*###**##*####*######*###*#####*-                           
                   ..:++-=*+ :-:*#***###**#++++##+###++*#**###**+++#####*=                          
                   =+-*+++++-::+##*++###***+++*##*###**+*#**###**+++##*#**+.                        
                  .=+-+====---+###**####*#*****##*#%**#***#***#******####**+:                       
                    .:.  .--**###**#####*##*****#*#%#*****#****#******####*##-.                     
                         --############*********#*##-*****#=**********########+.         .          
                        .=#*###*#####*#*#*********#+**##*##++***#****##########%:       .=          
                        =*#+###*###***#************=-.-**+++:+**#*****#########%%*-.   .=-:         
                       :+##=##**#*#****************-:.:-++++::+*******#######%###=+******+.         
                      .=###-##****#**++-++*******+*=:::::+++=::********##########*.  ....           
                      :+##%-###+****+++:=++*++++++++::=#%%%#*#+++******######*%###=                 
                      -*#%#:###****+=++:-=++*+++++++=-::#*%**-+=+******######*#%###.                
                     .=##%%-+###***+=#*@%%%#+*+++++++-..--:::::++******#######*#%##+                
                     :=#+%%+-#*#*****=:*++=+:=++++++++::::::::=++*****###%####+*####=.              
                     -=++#%*=++#*#**-:::--::..:--=++++=::::::=++******###%####+.##*+#+:.            
                     ---+#%#%+=******:::::::..::::::-====---=+++******##%##%##+ -#*.-++=-:          
                     --:+##%%%*:******:::::.................=++******#%%%#%%##+ -*-                 
                     .+:=##%%%##-******=::.................=+++*****#%%%#%%%###.+=.                 
                      :=-*#%+%%%#*+##**+::..........:.....:::=****###%%%%%%####+-.                  
                        .=#%--#%%%%#*##*==-....:::.::.......-****###%%%%##%%#*#+                    
                         -=#- -*##%%%#**+:........:........-***###%%%%%%+#%%#::+=:.                 
                          --+..:=**%%%%*#%+-:....::::....:=*####%%%%%%%%*%%#= ..                    
                            :-- .-=#%%%%%%%%%#-.:--:::::-*++###%%%%%%%%%%%#=  .#.                   
                              .- .-=#%%%%%%%%%%%+-==-:::--=###%%%#%%%##%%**=:.+%#.                  
                              .===+-*%%%%%###%=::::::::::-+=-=+%###%%##%####****-                   
                           :::::-=+#+%%%%%#*#*=:--::::::..:---+%#*######%##***=.  ..                
                           .=****#%%#%#%#*+-:::::::::::....:--:##::=*#######+===+*=.                
                             .-++**###+#-:::::-:.::::.......:-:=#::::*-=*####**+=.                  
                            :-:=+##*+-*:..::::-:--:::.........-:-:......+-:+++=:.                   
                           -.:-+++:==...  ....-===--:..........:..  . :+:=+++=-::::                 
                         .-:::=+++.+:       ..-------:.........:.   .:+:+++=:::::::-                
                        .-::::=++=:+.  .......-.......:::.......:   :+:+++-::::::::-.               
                        -:::::-++:-+ .........:-:::::::.::......: .:+:+++::-:::::::.-               
                       ::::::-:++.==..........:-::::-....:......: .+:+++:::-:::::::.-               
                      -:.::::=:++.=-...........=---:.....:......:.+-+++:::-::::::::::.              
                    .-..:::-:=-*+.+:........:::=--:......:......:=-=*+--=-:::::::::-::              
                   :-::::::=--=+=.+:.::--===---=---===-:::......-=-#*=--:::::::--:-=:-              
                 .-::::::::---=+=.===--:..:=*-====*=:::-=.......--#*=::::::::::::-==--              
                 -.::---:::::-++=::--+**####-=*#++*#*++=-.......:*==:::::::::::::::==-.             
                 -:-========-++++*#*######*-*####*-*####+.......:====-:::::-----::::--:             
                 -:-========-++*#######%%%#=#####*-#%%%#+.......:======--=======--:::--             
                  :-========++++%##########++#%%#=+#####=........+==-----=========--:-=.  
                  ''')